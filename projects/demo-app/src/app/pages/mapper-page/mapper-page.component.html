<!--
  Mapper Page - Example usage of data-mapper component

  This example shows:
  - Providing source and target schemas
  - Handling mapping change events
  - Export/import functionality
  - Custom styling via CSS variables (see .scss file)
-->
<div class="page-container">
  <header class="page-header">
    <div class="header-title">
      <button mat-icon-button (click)="goBack()" matTooltip="Back to Mappings">
        <mat-icon>arrow_back</mat-icon>
      </button>
      <div class="title-text">
        @if (currentMapping()) {
          @if (isEditingName()) {
            <div class="name-edit">
              <input
                #nameInput
                type="text"
                [value]="currentMapping()!.name"
                (keyup.enter)="saveName(nameInput.value)"
                (keyup.escape)="cancelEditName()"
                (blur)="saveName(nameInput.value)"
                class="name-input"
              />
            </div>
          } @else {
            <div class="name-display">
              <h1>{{ currentMapping()!.name }}</h1>
              <button mat-icon-button (click)="startEditName()" matTooltip="Edit name" class="edit-btn">
                <mat-icon>edit</mat-icon>
              </button>
            </div>
          }
          <p class="subtitle">
            {{ appState.getSchemaName(currentMapping()!.sourceSchemaId) }}
            <mat-icon class="flow-icon">arrow_forward</mat-icon>
            {{ appState.getSchemaName(currentMapping()!.targetSchemaId) }}
          </p>
        } @else {
          <h1>Data Mapper</h1>
          <p class="subtitle">Drag fields from source to target to create mappings</p>
        }
      </div>
    </div>
    <div class="header-actions">
      <button mat-stroked-button (click)="importMappings()">
        <mat-icon>upload</mat-icon>
        Import
      </button>
      <button mat-stroked-button (click)="exportMappings()" [disabled]="mappings().length === 0">
        <mat-icon>download</mat-icon>
        Export
      </button>
      <button mat-stroked-button (click)="clearMappings()" [disabled]="mappings().length === 0">
        <mat-icon>delete_sweep</mat-icon>
        Clear
      </button>
    </div>
    <input
      #fileInput
      type="file"
      accept=".json"
      style="display: none"
      (change)="onFileSelected($event)"
    />
  </header>

  <main class="page-main">
    <!--
      data-mapper component usage:
      - [sourceSchema]: The source JSON schema to map from
      - [targetSchema]: The target JSON schema to map to
      - [sampleData]: Optional sample data for preview
      - (mappingsChange): Emits when mappings are created/modified/deleted
    -->
    <data-mapper
      [sourceSchema]="sourceSchema()"
      [targetSchema]="targetSchema()"
      [sampleData]="sampleData()"
      (mappingsChange)="onMappingsChange($event)"
    ></data-mapper>
  </main>
</div>
