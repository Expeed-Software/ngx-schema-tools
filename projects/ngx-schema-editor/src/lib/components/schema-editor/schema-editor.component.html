<div class="schema-editor">
  <!-- Schema Header -->
  <div class="editor-header">
    @if (showSchemaName) {
      <div class="schema-name-section">
        <mat-form-field appearance="outline" class="schema-name-field">
          <mat-label>Schema Name</mat-label>
          <input
            #schemaNameInput
            matInput
            [value]="schemaName()"
            (input)="onSchemaNameChange($any($event.target).value, schemaNameInput)"
            placeholder="Enter schema name"
          />
        </mat-form-field>
      </div>
    }

    @if (showJsonToggle) {
      <mat-button-toggle-group [value]="viewMode()" (change)="setViewMode($event.value)" class="view-toggle">
        <mat-button-toggle value="visual">Visual</mat-button-toggle>
        <mat-button-toggle value="json">JSON</mat-button-toggle>
      </mat-button-toggle-group>
    }

    <div class="header-actions">
      @if (viewMode() === 'visual') {
        <button mat-flat-button color="primary" (click)="addField()">
          <mat-icon>add</mat-icon>
          Add Field
        </button>
      } @else {
        <button mat-stroked-button (click)="copyJson()" matTooltip="Copy JSON to clipboard">
          <mat-icon>content_copy</mat-icon>
          Copy
        </button>
        <button mat-stroked-button (click)="formatJson()">
          <mat-icon>auto_fix_high</mat-icon>
          Format
        </button>
        <button mat-flat-button color="primary" (click)="applyJsonChanges()" [disabled]="jsonError()">
          <mat-icon>check</mat-icon>
          Apply
        </button>
      }
    </div>
  </div>

  <!-- JSON View -->
  @if (viewMode() === 'json') {
    <div class="json-view">
      @if (jsonError()) {
        <div class="json-error">
          <mat-icon>error</mat-icon>
          {{ jsonError() }}
        </div>
      }
      <textarea
        class="json-textarea"
        [value]="jsonText()"
        (input)="onJsonTextChange($any($event.target).value)"
        spellcheck="false"
      ></textarea>
    </div>
  }

  <!-- Fields List (Visual View) -->
  <div class="fields-container" [class.hidden]="viewMode() === 'json'">
    @if (fields().length === 0) {
      <div class="empty-state">
        <mat-icon>schema</mat-icon>
        <p>No fields yet. Click "Add Field" to get started.</p>
      </div>
    } @else {
      <div
        class="fields-list"
        cdkDropList
        [cdkDropListData]="fields()"
        (cdkDropListDropped)="onFieldDrop($event)"
      >
        @for (field of fields(); track field.id) {
          <field-item
            cdkDrag
            [field]="field"
            [parentList]="fields()"
            [level]="0"
            [showDisplayType]="showDisplayType"
            (fieldChange)="onFieldChange()"
            (delete)="onFieldDelete($event)"
            (duplicate)="onFieldDuplicate($event)"
            (addAfter)="onFieldAddAfter($event)"
          >
            <!-- Drag Placeholder -->
            <div class="drag-placeholder" *cdkDragPlaceholder></div>
            <!-- Drag Preview -->
            <div *cdkDragPreview class="drag-preview">
              <mat-icon>{{ getTypeIcon(field.type) }}</mat-icon>
              {{ field.name || 'unnamed' }}
            </div>
          </field-item>
        }
      </div>
    }
  </div>
</div>
